language: php

sudo: required

addons:
  chrome: stable
  firefox: latest

before_install:
  - nvm install node
  # - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &

php:
  - "7.4"

install:
  - npm install

script:
  - echo "APP_ENV=prod" >> .env

  - composer install

  - composer require --dev dbrekelmans/bdi
  - vendor/bin/bdi detect drivers

  - npm run build

  - php bin/console doctrine:database:create --env=test
  - php bin/console doctrine:schema:update --env=test --force
  - php bin/console hautelook:fixtures:load --env=test --no-interaction
  - php bin/console doctrine:database:create --env=dev
  - php bin/console doctrine:schema:update --env=dev --force
  - php bin/console hautelook:fixtures:load --env=dev --no-interaction

  - php bin/phpunit tests/Entity
  - php bin/phpunit tests/Repository
  - php bin/phpunit tests/Controller
  - php bin/phpunit tests/EndToEnd
