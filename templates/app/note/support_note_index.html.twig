{% extends 'base.html.twig' %}

{% set nb_notes = notes|length %}

{% block title %}Notes sociales{% endblock %}

{% block body %}

	<div class="container">

		{% set title = 'Notes sociales' %}
		{% include 'app/support/_partials/_nav_support.html.twig' %}

		<div class="row mb-2">
			<div id="js-search-support-notes" class="col-md-12">
				{% include 'app/note/_support_note_form_search.html.twig' %}
			</div>
		</div>
		<div class="row mb-3">
			<div class="col-md-12">
				<button class="btn btn-{{ theme_color }} btn-sm shadow mr-2" data-action="new_note"
					title="Créer une nouvelle note" data-toggle="tooltip" data-placement="bottom">
					<i class="fas fa-plus-square mr-2"></i>Nouvelle note</button>
				<div class="d-inline align-middle">Total :
					<span id="count-notes" data-nb-total-notes="{{ nb_total_notes }}">
					{{ nb_notes }} note{% if nb_notes > 1 %}s{% endif %}
					{{ nb_total_notes ? ' sur ' ~ nb_total_notes }}</span>
				</div>
			</div>
		</div>
		
		<div class="row">
			<div class="col-md-7 mb-2">
				{% if notes.getTotalItemCount %}
					<span class="btn btn-outline-secondary btn-sm m-1 px-2 shadow-sm">
						{{ knp_pagination_sortable(notes, 'Titre', 'n.title') }}
					</span>
					<span class="btn btn-outline-secondary btn-sm m-1 px-2 shadow-sm">
						{{ knp_pagination_sortable(notes, 'Date de création', 'n.createdAt') }}
					</span>
					<span class="btn btn-outline-secondary btn-sm m-1 px-2 shadow-sm">
						{{ knp_pagination_sortable(notes, 'Date de mise à jour', 'n.updatedAt') }}
					</span>
				{% endif %}
			</div>
			<div class="col-md-5">
				<div class="navigation">{{ knp_pagination_render(notes) }}</div>
			</div>
		</div>

		<div id="container-notes" class="row" data-support="{{ support.id }}">
			{% for note in notes %}
				<div class="col-sm-12 col-lg-6 mb-4 reveal" data-note-id="{{ note.id }}">
					<div class="card h-100 shadow">
						<div class="card-header">
							<h3 class="card-title h5 text-{{ theme_color }} cursor-pointer"
								title="Voir la note" data-placement="bottom">{{ note.title }}</h3>
							<span data-note-type={{ note.type }}>{{ note.typeToString }}</span>
							(<span data-note-status={{ note.status }}>{{ note.statusToString }}</span>)
							<span class="small text-secondary" data-note-created="true">
								| Créé le {{ note.createdAt|date('d/m/Y à H:i') }} par {{ note.createdBy.fullname }}
							</span>
							<span class="small text-secondary" data-note-updated="true">
								{% if note.updatedAt != note.createdAt and note.updatedBy %}
									(modifié le {{ note.updatedAt|date('d/m/Y à H:i') }} par {{ note.updatedBy.fullname }})
								{% endif %}
							</span>

							<div class="mt-2 tags-list">
								{% for tag in note.tags %}
									<span class="badge bg-{{ tag.color }} text-light" 
										data-tag-id="{{ tag.id }}">{{ tag.name }}</span>
								{% endfor %}
							</div>

						</div>
						<div class="card-body note-content cursor-pointer" title="Voir la note" 
							data-toggle="tooltip" data-placement="bottom">
							<div class="card-text">{{ note.content|raw }}</div><span class="note-fadeout"></span>
						</div>
					</div>
				</div>
			{% else %}
				<div class="col-md-12 sr-only">
					<p>Aucune note.</p>
				</div>
			{% endfor %}
		</div>

		<div class="navigation">{{ knp_pagination_render(notes) }}</div>

	</div>

	{% include 'app/note/_note_form_modal.html.twig' %}
	{% include 'model/_confirmModal.html.twig' %}

{% endblock %}

{% block javascripts %}
	{{ encore_entry_script_tags('search') }}
	{{ encore_entry_script_tags('note') }}
{% endblock javascripts %}
