{% extends 'base.html.twig' %}

{% block title %}Rendez-vous{% endblock %}

{% block body %}

    <div class="container">

        {% set title = 'Rendez-vous' %}
        {% include 'app/support/_partials/_support_nav.html.twig' %}

		<div class="row mb-2">
			<div class="col-md-12">
                {% include 'app/rdv/_searchSupportRdvs.html.twig' %}
			</div>
		</div>

        <div class="row mb-3">
            <div class="d-flex col-md-6 mb-1 align-items-center">
                <a href="{{ path('support_calendar_show', {'id': support.id}) }}" class="btn btn-{{ theme_color }} btn-sm shadow mr-2"
                   title="Passer en vue agenda" data-toggle="tooltip" data-placement="bottom" ><i class="far fa-calendar-alt"></i></a>
                <a id="js-new-rdv" href="{{ path('support_calendar_show', {'id': support.id}) }}" 
                    class="btn btn-{{ theme_color }} btn-sm shadow mr-2" title="Ajouter un rdv" data-toggle="tooltip" 
                    data-placement="bottom" ><i class="fas fa-plus-square mr-2"></i>Nouveau RDV</a>
                <div class="d-inline align-middle">Total :
                    <span id="count-rdvs">{{ rdvs.getTotalItemCount|number }}</span>
                    rdv{% if rdvs.getTotalItemCount > 1 %}s{% endif %}.
                </div>
            </div>
            <div class="col-md-6">
                <div class="navigation">{{ knp_pagination_render(rdvs) }}</div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table id="table-rdvs" class="table e table-bordered table-striped table-hover text-dark">
                        <thead>
                            <tr>
                                <th scope="col" class="align-middle th-w-20"></th>
                                <th scope="col" class="align-middle th-w-120">
                                    {{ knp_pagination_sortable(rdvs, 'Titre RDV', 'r.title') }}</th>
                                <th scope="col" class="align-middle th-date">
                                    {{ knp_pagination_sortable(rdvs, 'Date', 'r.start') }}</th>
                                <th scope="col" class="align-middle th-w-60">
                                    {{ knp_pagination_sortable(rdvs, 'Statut', 'r.status') }}</th>
                                <th scope="col" class="align-middle th-w-100">
                                    {{ knp_pagination_sortable(rdvs, 'Lieu', 'r.location') }}</th>
                                <th scope="col" class="align-middle th-w-100">Étiquette(s)</th>
                                <th scope="col" class="align-middle th-w-150">
                                    {{ knp_pagination_sortable(rdvs, 'Contenu', 'r.content') }}</th>
                                <th scope="col" class="align-middle th-date">
                                    {{ knp_pagination_sortable(rdvs, 'Créé le', 'r.createdAt') }}</th>
                                <th scope="col" class="align-middle th-w-100">
                                    {{ knp_pagination_sortable(rdvs, 'Créé par', 'u.lastname') }}</th>
                                <th scope="col" class="align-middle th-w-20"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rdv in rdvs %}
                                <tr id="rdv-{{ rdv.id }}" class="js-rdv">
                                    <td class="align-middle text-center">
                                        <a class="btn btn-{{ theme_color }} btn-sm shadow"  href="{{ path('support_calendar_show',
                                            {'id': rdv.supportGroup.id, 'year': rdv.start|date('Y'),'month': rdv.start|date('m'), 
                                            'rdv_id': rdv.id}) }}" title="Voir le rendez-vous" data-toggle="tooltip" 
                                            data-placement="bottom"><i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                    <td class="align-middle">{{ rdv.title }}</td>
                                    <td class="align-middle">{{ rdv.start|date('d/m/Y') }}<br/>
                                        {{ rdv.start|date('H:i') }} – {{ rdv.end|date('H:i') }}</td>
                                    <td class="align-middle">{{ rdv.start|date('Y-m-d-H') > 'now'|date('Y-m-d-H') ? 'À venir' :
                                        rdv.statusToString }}</td>
                                    <td class="align-middle">{{ rdv.location }}</td>
                                    <td class="align-middle">
                                        {% for tag in rdv.tags %}
                                            <span class="badge bg-{{ tag.color }} text-light">{{ tag.name }}</span>
                                        {% endfor %}
                                    </td>
                                        <td class="align-middle">{{ rdv.content }}</td>
                                    <td class="align-middle">{{ rdv.createdAt ? rdv.createdAt|date('d/m/Y H:i') }}</td>
                                    <td class="align-middle">{{ rdv.createdBy ? rdv.createdBy.fullname }}</td>
                                    <td class="align-middle text-center">
                                        {% if is_granted('DELETE', rdv) %}
                                            <button data-url="{{ path('rdv_delete', {'id': rdv.id}) }}" 
                                                class="js-delete btn btn-danger btn-sm shadow my-1" title="Supprimer le rendez-vous" 
                                                data-toggle="tooltip" data-placement="bottom"><i class="fas fa-trash-alt"></i>
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="navigation">{{ knp_pagination_render(rdvs) }}</div>
            </div>
        </div>
    </div>

	{% include 'app/rdv/_deleteRdvModal.html.twig' %}

{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('search') }}
    {{ encore_entry_script_tags('rdvs') }}
{% endblock javascripts %}
